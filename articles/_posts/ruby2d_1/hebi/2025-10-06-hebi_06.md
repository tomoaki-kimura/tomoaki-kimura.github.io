---
layout: post
part: Ruby2D(1)
title: ヘビゲーム
categories: [ruby2d_1, hebi]
chapter: 1
section: 6
section_title: リスタートできるようにする
description: 最初のステップ。スクラッチの始め方を紹介します。
---

## {{ page.section_title }}

### 初期状態に戻す

main.rb
```
(略)
on :key_down do |event|
  # ゲームスタート
  if event.key == "right" || event.key == "left"
    status = :game_start if status == :stop
  end
  # リスタート
  if event.key == "r" && status == :game_over
    status = :stop
    head.x = Window.width / 2
    head.y = Window.height / 2
    x_flug = true
    y_flug = false
    message.each { |text| text.remove }
  end
  # 右上に移動の時
(略)
```

### ファイルの実行

bash
```
$ ruby main.rb
```

### 結果

自機が壁に当たるとゲームオーバー画面からR押下で初期画面に復旧
。
リスタートが可能。

#### *ここで試したいこと

- 繰り返し遊んで当たり判定のエラーなどないか最終確認しておく。

### ここまでのコード

main.rb
```
require "ruby2d"

# ヘビの頭
head = Circle.new(radius: 10)
head.x = Window.width / 2
head.y = Window.height / 2
speed = 1
x_flug = true
y_flug = false
status = :stop

# ゲームオーバー画面
message = [
  Text.new("GAME OVER", size: 30, x: 220, y: 150),
  Text.new("press key 'R' to restart", size: 20, x: 205, y: 300)
]
message.each { |text| text.remove }

def hit(head)
  # 上の当たり判定
  top = head.contains?(head.x, 0)
  # 下の当たり判定
  bottom = head.contains?(head.x, Window.height)
  # 右の当たり判定
  right = head.contains?(Window.width, head.y)
  # 左の当たり判定
  left = head.contains?(0, head.y)
  top || bottom || right || left
end

on :key_down do |event|
  # ゲームスタート
  if event.key == "right" || event.key == "left"
    status = :game_start if status == :stop
  end
  # リスタート
  if event.key == "r" && status == :game_over
    status = :stop
    head.x = Window.width / 2
    head.y = Window.height / 2
    x_flug = true
    y_flug = false
    message.each { |text| text.remove }
  end
  # 右上に移動の時
  if x_flug && !y_flug
    case event.key
    when "right"
      y_flug = true
    when "left"
      x_flug = false
    end
  # 左上に移動の時
  elsif !x_flug && !y_flug
    case event.key
    when "right"
      x_flug = true
    when "left"
      y_flug = true
    end
  # 右下に移動の時
  elsif x_flug && y_flug
    case event.key
    when "right"
      x_flug = false
    when "left"
      y_flug = false
    end
  # 左下に移動の時
  elsif !x_flug && y_flug
    case event.key
    when "right"
      y_flug = false
    when "left"
      x_flug = true
    end
  end
end

update do
  case status
  when :game_start
    # 当たり判定
    if hit(head)
      status = :game_over
      message.each { |text| text.add }
    end
    # 移動方向の管理
    if x_flug
      head.x += speed
    else
      head.x -= speed
    end
    if y_flug
      head.y += speed
    else
      head.y -= speed
    end
  end
end

show
```