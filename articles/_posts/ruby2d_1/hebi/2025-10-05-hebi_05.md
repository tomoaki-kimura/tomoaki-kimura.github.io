---
layout: post
part: Ruby2D(1)
title: ヘビゲーム
categories: [ruby2d_1, hebi]
chapter: 1
section: 5
section_title: ゲームオーバーを作る
description: 最初のステップ。スクラッチの始め方を紹介します。
---

## {{ page.section_title }}

### ステータスを管理する

main.rb
```
(略)
speed = 1
x_flug = true
y_flug = false
status = :stop

on :key_down do |event|
  # ゲームスタート
  if event.key == "right" || event.key == "left"
    status = :game_start if status == :stop
  end
  # 右上に移動の時
  if x_flug && !y_flug
    case event.key
(略)

(略)
update do
  case status
  when :game_start
    if x_flug
      head.x += speed
    else
      head.x -= speed
    end
    if y_flug
      head.y += speed
    else
      head.y -= speed
    end
  end
  p status
end

show
```

### ファイルの実行

bash
```
$ ruby main.rb
```

### 結果

スタート時は動かず、移動押下で初動。

この時、ターミナルに表示されているフラグが、 `:stop` から `:game_start` に変化。

### 壁に当たった時のステータス

main.rb
```
(略)
y_flug = false
status = :stop

def hit(head)
  # 上の当たり判定
  top = head.contains?(head.x, 0)
  # 下の当たり判定
  bottom = head.contains?(head.x, Window.height)
  # 右の当たり判定
  right = head.contains?(Window.width, head.y)
  # 左の当たり判定
  left = head.contains?(0, head.y)
  top || bottom || right || left
end

on :key_down do |event|
(略)

(略)
update do
  case status
  when :game_start
    # 当たり判定
    if hit(head)
      status = :game_over
    end
    # 移動方向の管理
    if x_flug
      head.x += speed
    else
      head.x -= speed
    end
    if y_flug
      head.y += speed
    else
      head.y -= speed
    end
  end
end

show
```

### ファイルの実行

bash
```
$ ruby main.rb
```

### 結果

自機が壁に当たるとターミナルに `:game_over` が表示され、動きも止まる。

### ゲームスタートのステータス

main.rb
```
(略)
on :key_down do |event|
  # ゲームスタート
  if event.key == "right" || event.key == "left"
    status = :game_start if status == :stop
  end
  # 右上に移動の時
  if x_flug && !y_flug
    case event.key
(略)
```

### ファイルの実行

bash
```
$ ruby main.rb
```

### 結果

スタート時は動かず、移動押下で初動。

この時、ターミナルに表示されているフラグが、 `:stop` から `:game_start` に変化。

### ゲームオーバーのメッセージを表示する

main.rb
```
require "ruby2d"

# ヘビの頭
head = Circle.new(radius: 10)
head.x = Window.width / 2
head.y = Window.height / 2
speed = 1
x_flug = true
y_flug = false
status = :stop

# ゲームオーバー画面
message = [
  Text.new("GAME OVER", size: 30, x: 220, y: 150),
  Text.new("press key 'R' to restart", size: 20, x: 205, y: 300)
]
message.each { |text| text.remove }

def hit(head)
(略)

(略)
update do
  case status
  when :game_start
    # 当たり判定
    if hit(head)
      status = :game_over
      message.each { |text| text.add }
    end
    # 移動方向の管理
(略)
```

### ファイルの実行

bash
```
$ ruby main.rb
```

### 結果

自機が壁に当たるとゲームオーバー画面になる。

うまくいったらここで、 

```
p status
```

は不要になるので、削除しておきます。

#### *ここで試したいこと

- ゲームオーバー画面の文字の大きさを変えたら、文字の場所がどうなるか確認する。

### ここまでのコード

main.rb
```
require "ruby2d"

head = Circle.new(radius: 10)
head.x = Window.width / 2
head.y = Window.height / 2
speed = 1
status = :stop
message = [
  Text.new("GAME OVER", size: 30, x: 220, y: 150),
  Text.new("press key 'R' to restart", size: 20, x: 205, y: 300)
]
message.each { |text| text.remove }

x_flug = true
y_flug = false

def hit(head)
  #上の当たり判定
  top = head.contains?(head.x, 0)
  #下の当たり判定
  bottom = head.contains?(head.x, Window.height)
  #右の当たり判定
  right = head.contains?(Window.width, head.y)
  #左の当たり判定
  left = head.contains?(0, head.y)
  top || bottom || right || left
end

on :key_down do |event|
  #ゲームスタート
  if event.key == "right" || event.key == "left"
    status = :game_start if status == :stop
  end
  #右上に移動の時
  if x_flug && !y_flug
    case event.key
    when "right"
      y_flug = true
    when "left"
      x_flug = false
    end
  #左上に移動の時
  elsif !x_flug && !y_flug
    case event.key
    when "right"
      x_flug = true
    when "left"
      y_flug = true
    end
  #右下に移動の時
  elsif x_flug && y_flug
    case event.key
    when "right"
      x_flug = false
    when "left"
      y_flug = false
    end
  #左下に移動の時
  elsif !x_flug && y_flug
    case event.key
    when "right"
      y_flug = false
    when "left"
      x_flug = true
    end
  end
end

update do
  case status
  when :game_start
    #当たり判定
    if hit(head)
      status = :game_over
      message.each { |text| text.add }
    end
    #移動方向の管理
    if x_flug
      head.x += speed
    else
      head.x -= speed
    end
    if y_flug
      head.y += speed
    else
      head.y -= speed
    end
  end
end

show
```